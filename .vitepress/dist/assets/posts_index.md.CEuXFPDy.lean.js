import{_ as d,c as i,o as a,F as p,B as r,j as n,e as E,t as h,G as g,a as o,k as y}from"./chunks/framework.CBg6nt2o.js";const F=JSON.parse('[{"html":"<h1 id=\\"golang-migrateã‚’åˆ©ç”¨ã—ãŸãƒ†ã‚™ãƒ¼ã‚¿ãƒ˜ã‚™ãƒ¼ã‚¹ãƒ’ã‚¹ãƒˆãƒªãƒ¼ä¿å­˜\\" tabindex=\\"-1\\">Golang-migrateã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ’ã‚¹ãƒˆãƒªãƒ¼ä¿å­˜ <a class=\\"header-anchor\\" href=\\"#golang-migrateã‚’åˆ©ç”¨ã—ãŸãƒ†ã‚™ãƒ¼ã‚¿ãƒ˜ã‚™ãƒ¼ã‚¹ãƒ’ã‚¹ãƒˆãƒªãƒ¼ä¿å­˜\\" aria-label=\\"Permalink to &quot;Golang-migrateã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ’ã‚¹ãƒˆãƒªãƒ¼ä¿å­˜&quot;\\">&ZeroWidthSpace;</a></h1>\\n<h2 id=\\"æ¦‚è¦\\" tabindex=\\"-1\\">æ¦‚è¦ <a class=\\"header-anchor\\" href=\\"#æ¦‚è¦\\" aria-label=\\"Permalink to &quot;æ¦‚è¦&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>é–‹ç™ºã‚’ã—ãªãŒã‚‰ã€Domain Schemaã«å¯¾ã—ã¦ä¿®æ­£ãŒå…¥ã‚‹æ™‚ã«Table Schemaå¤‰æ›´ãŒèµ·ãã‚‹çŠ¶æ³ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\nTest Fileã§ã¯ã‚ˆãä½œå‹•ã§ãã¾ã™ãŒã€æœ¬ç•ªDBã®æ™‚ã«ã¯å‹æ‰‹ã«Table Schemaã‚’å¤‰æ›´ã§ããªã„ã®ã§DB Migrationã‚’å°å…¥ã—ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚\\nä¸€å›ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹çŠ¶æ³ã§ã®Table Schemaå¤‰æ›´ã¯ãƒªã‚¹ã‚¯ãŒé«˜ãé™ç•ŒãŒã‚ã‚‹ã¨æ„Ÿã˜ãŸã‹ã‚‰ã§ã™ã€‚\\nãªã®ã§DBã«å¯¾ã—ã¦Versionç®¡ç†ã‚’ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚</p>\\n<h2 id=\\"å†…å®¹\\" tabindex=\\"-1\\">å†…å®¹ <a class=\\"header-anchor\\" href=\\"#å†…å®¹\\" aria-label=\\"Permalink to &quot;å†…å®¹&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>ç¾åœ¨è‡ªåˆ†ãŒå€‹äººé–‹ç™ºã—ã¦ã„ã‚‹ã€ŒGAMERSã€ã¯Goã€DiscordGo Libraryã‚’åˆ©ç”¨ã—ã¦ã€ãƒœãƒƒãƒˆã¨WASã¨ã®Micro Service Architectureå½¢ã§æŒ‘æˆ¦ã—ã¦ã¾ã™ã€‚\\nã“ã“ã§Goã§ã®Migrationã¯golang-migrateã®migrate Libraryã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚\\né–‹ç™ºã‚’é€²ã¿ãªãŒã‚‰ã€è‡ªåˆ†ã®ãƒŸã‚¹ã§Passwordã®ã‚¹ã‚­ãƒ¼ãƒæ¡ä»¶ãŒVARCHAR(16)ã¨ã—ã¦è¨­å®šã•ã‚Œã€æš—å·åŒ–ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¿å­˜ã§ããªã„çŠ¶æ³ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\nã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‚‚ã†ä¸€åº¦ä½œã‚‹ã®ã‚‚ã‚ã‚Šã¾ã—ãŸãŒã€æœ¬ç•ªDBãŒã‚ã£ãŸã®ã§ãã®DBã‚‚å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚\\nãªã®ã§ã“ã‚Œã‚’Version 2ã¨ã—ã¦å¤‰æ›´äº‹é …ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚\\ngolangã®migrateã¯Flywayã¨é•ã£ã¦ã€Versionã¥ã¤ Up, Down SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€è‡ªåˆ†ã¨ã—ã¦ã©ã†ã‚„ã£ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚„ã€ãƒ€ã‚¦ãƒ³ã•ã‚Œã‚‹ã®ã‹ã™ãè¦‹ãˆã¦ç†è§£ã—ã‚„ã™ã‹ã£ãŸã§ã™ã€‚\\nå¾Œã§ã¯Makefileã§DB Versionç®¡ç†ã«åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ä»Šå¾Œãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒå…¥ã£ã¦ããŸæ™‚ä¾¿åˆ©ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†æ›¸é¡åŒ–ã—ã¾ã—ãŸã€‚</p>\\n<div class=\\"language-makefile vp-adaptive-theme\\"><button title=\\"Copy Code\\" class=\\"copy\\"></button><span class=\\"lang\\">makefile</span><pre class=\\"shiki shiki-themes github-light github-dark vp-code\\" tabindex=\\"0\\" v-pre=\\"\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-up</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Run all pending migrations</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"ğŸ”„ Running migrations...\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tmigrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-down</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Rollback last migration</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"âª Rolling back last migration...\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tmigrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" down 1</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-down-all</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Rollback all migrations</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"âª Rolling back all migrations...\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">read -p \\"Are you sure? [y/N] \\" -n 1 -r; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\techo; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tif [[ </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">$$</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">REPLY =~ ^[Yy]</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">$$</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> ]]; then </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\tmigrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" down -all; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tfi</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-create</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Create new migration (usage: make migrate-create name=create_users_table)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">if [ -z \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">name</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" ]; then </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\techo \\"âŒ Error: name parameter is required\\"; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\techo \\"Usage: make migrate-create name=create_users_table\\"; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\texit 1; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tfi</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"ğŸ“ Creating migration: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">name</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tmigrate create -ext sql -dir </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -seq </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">name</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-version</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Show current migration version</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">migrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" version</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-force</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Force set migration version (usage: make migrate-force version=1)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">if [ -z \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">version</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" ]; then </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\techo \\"âŒ Error: version parameter is required\\"; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\techo \\"Usage: make migrate-force version=1\\"; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\t\\texit 1; </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">\\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tfi</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"âš ï¸ Forcing migration version to </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">version</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">...\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tmigrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" force </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">version</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-up-docker</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Run migrations in Docker environment</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"ğŸ”„ Running migrations (Docker)...\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tmigrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-down-docker</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Rollback migration in Docker environment</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">echo \\"âª Rolling back migration (Docker)...\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\tmigrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" down 1</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">migrate-version-docker</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">: </span><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">## Show migration version in Docker</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">\\t@</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">migrate -path </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">MIGRATIONS_PATH</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> -database \\"</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">$(</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">DB_URL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">)</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">\\" version</span></span></code></pre>\\n</div><p>è‡ªåˆ†ã¯ä»Šç¾åœ¨Dockerfileã§Deployã—ã¦ã„ã¾ã™ã®ã§Dockerã‚’é€šã˜ã¦MigrateãŒã§ãã‚‹ã‚ˆã†ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆã—ã¨ãã¾ã—ãŸã€‚\\næœ€å¾Œã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ãŸå¾Œã®çµæœã€ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚ŒãŸã®ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p>\\n<h2 id=\\"çµè«–\\" tabindex=\\"-1\\">çµè«– <a class=\\"header-anchor\\" href=\\"#çµè«–\\" aria-label=\\"Permalink to &quot;çµè«–&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>å®Ÿéš›æœ¬ç•ªDBã«ä½¿ã†ãŸã‚ã«Migrateã‚’é©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸãŒã€Migrateã‚’çŸ¥ã‚‹å‰ã¾ã§ã¯æœ¬ç•ªDBã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¤‰ãˆã‚‹æ™‚ãŒå¤šã‹ã£ãŸã®ã§ã™ã€‚\\nã ãŒéŸ“å›½ã®å¤§å­¦ã§GDGoCæ´»å‹•ã‚’ã‚„ã‚ŠãªãŒã‚‰ã“ã®ã‚ˆã†ãªè¡Œç‚ºãŒå±ãªã„ã“ã¨ãªã®ã‚’èªçŸ¥ã—ã¦åˆã‚ã¦å°å…¥ã—ã¦ã¿ã¾ã—ãŸãŒã€é–‹ç™ºã™ã‚‹æ™‚ã‚‚ä¾¿åˆ©ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ†åˆ¥ã™ã‚‹ã“ã¨ãŒã§ãã¦æ¥½ã«é–‹ç™ºãŒã§ãã¾ã—ãŸã€‚\\nä»Šã¾ã§ã¯ç°¡å˜ãªMigrateã ã‘ã§ã—ãŸãŒã€ã‚‚ã£ã¨ã‚µãƒ¼ãƒ“ã‚¹ãŒå¤§ãããªã£ã¦ä¿®æ­£äº‹é …ãŒå¤šããªã£ãŸæ™‚ã«ã©ã†ã‚„ã£ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ†ã‘ã‚‹ã®ã‹ã‚’å‹‰å¼·ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚</p>\\n","frontmatter":{"title":"Golang-migrateã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ’ã‚¹ãƒˆãƒªãƒ¼ä¿å­˜","description":"Golang-migrateã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ’ã‚¹ãƒˆãƒªãƒ¼ä¿å­˜ MySQL","date":"2026-01-14T03:35:00.000Z","categories":["Tech"],"tags":["Go","MySQL","DB","Migrate","Japanese"]},"excerpt":"","url":"/posts/golang-migrate-history/"},{"html":"<div class=\\"posts-container\\">\\n<h2 id=\\"all-posts\\" tabindex=\\"-1\\">All Posts <a class=\\"header-anchor\\" href=\\"#all-posts\\" aria-label=\\"Permalink to &quot;All Posts&quot;\\">&ZeroWidthSpace;</a></h2>\\n<PostList :posts=\\"posts\\" /></div>\\n","frontmatter":{"layout":"page","title":"Posts"},"excerpt":"","url":"/posts/"},{"html":"<h1 id=\\"tokenæ¤œè¨¼ã«å¯¾ã™ã‚‹å·¥å¤«\\" tabindex=\\"-1\\">Tokenæ¤œè¨¼ã«å¯¾ã™ã‚‹å·¥å¤« <a class=\\"header-anchor\\" href=\\"#tokenæ¤œè¨¼ã«å¯¾ã™ã‚‹å·¥å¤«\\" aria-label=\\"Permalink to &quot;Tokenæ¤œè¨¼ã«å¯¾ã™ã‚‹å·¥å¤«&quot;\\">&ZeroWidthSpace;</a></h1>\\n<h2 id=\\"ãƒ†ã‚¯ã‚¹ã‚¿ãƒƒã‚¯\\" tabindex=\\"-1\\">ãƒ†ã‚¯ã‚¹ã‚¿ãƒƒã‚¯ <a class=\\"header-anchor\\" href=\\"#ãƒ†ã‚¯ã‚¹ã‚¿ãƒƒã‚¯\\" aria-label=\\"Permalink to &quot;ãƒ†ã‚¯ã‚¹ã‚¿ãƒƒã‚¯&quot;\\">&ZeroWidthSpace;</a></h2>\\n<ul>\\n<li>Java 21</li>\\n<li>Java SpringBoot 3.5.6</li>\\n<li>MySQL 8.0</li>\\n</ul>\\n<h2 id=\\"æ¦‚è¦\\" tabindex=\\"-1\\">æ¦‚è¦ <a class=\\"header-anchor\\" href=\\"#æ¦‚è¦\\" aria-label=\\"Permalink to &quot;æ¦‚è¦&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>ã‚ã‚‹æ—¥ã€è‡ªåˆ†ãŒã‚„ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰Tokenæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ„ã‚“ã§æ¬²ã—ã„ã¨ã„ã†è¦æ±‚ã‚’è²°ã„ã¾ã—ãŸã€‚\\nå½“æ™‚è‡ªåˆ†ã¯<strong>HandlerMethodArgumentResolver</strong>ã‚’ä½¿ã£ã¦ã€Annotationã§ã®Member IDã‚’æŒã£ã¦ãã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œè¨¼ã‚’ã‚„ã‚Šã¾ã—ãŸã€‚</p>\\n<div class=\\"language-java vp-adaptive-theme\\"><button title=\\"Copy Code\\" class=\\"copy\\"></button><span class=\\"lang\\">java</span><pre class=\\"shiki shiki-themes github-light github-dark vp-code\\" tabindex=\\"0\\" v-pre=\\"\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">HandlerMethodArgumentResolver</span></span></code></pre>\\n</div><p>ãã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’PRã§é€ã£ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è²°ã„ã¾ã—ãŸãŒã€ã‚³ãƒ¡ãƒ³ãƒˆã§ã¯ä¸‹ã®ã‚ˆã†ãªè¨€è‘‰ãŒã‚ã‚Šã¾ã—ãŸã€‚\\nã€Œã‚‚ã—æ¤œè¨¼ã®ãŸã‚ã«ã¯çµ¶å¯¾ã«Member IDã‚’å—ã‘å–ã‚‹å¤‰æ•°ã‚’è¨­å®šã—ãªã„ã¨ãƒ€ãƒ¡ã§ã™ã‹ï¼Ÿä»–ã®æ–¹æ³•ã¯ãªã„ã‚“ã§ã™ã‹ï¼Ÿã€\\nã“ã‚Œã‚’èã„ã¦ã€ä»Šã¾ã§ç„¡æ„è­˜ã§<strong>HandlerMethodArgumentResolver</strong>ã‚’ä½¿ã£ã¦ã„ãŸã“ã¨ã‚’æ°—ã¥ã„ã¦Refactoringã‚’ã‚„ã‚Šã¾ã—ãŸã€‚</p>\\n<p>ã“ã®ãƒãƒ¼ã‚¹ãƒˆã¯å½“æ™‚Refactoringã§ã®è‡ªåˆ†ã®è€ƒãˆã‚’ä½œæˆã—ã¾ã™ã€‚\\nãã—ã¦ä¸‹ã®ã‚ˆã†ã«ãƒ†ãƒ¼ãƒã‚’æ±ºã‚ã¦è©±ã—ã¦ã„ã“ã†ã¨æ€ã£ã¦ãŠã‚Šã¾ã™ã€‚</p>\\n<ol>\\n<li>ãªãœHandlerMethodArgumentResolverã§ä½œã£ãŸã®ã‹</li>\\n<li>è‡ªåˆ†ã®è€ƒãˆ</li>\\n</ol>\\n<h2 id=\\"_1-ãªã›ã‚™handlermethodargumentresolverã¦ã‚™æ¤œè¨¼ã—ãŸã®ã‹\\" tabindex=\\"-1\\">1. ãªãœHandlerMethodArgumentResolverã§æ¤œè¨¼ã—ãŸã®ã‹ <a class=\\"header-anchor\\" href=\\"#_1-ãªã›ã‚™handlermethodargumentresolverã¦ã‚™æ¤œè¨¼ã—ãŸã®ã‹\\" aria-label=\\"Permalink to &quot;1. ãªãœHandlerMethodArgumentResolverã§æ¤œè¨¼ã—ãŸã®ã‹&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>ã¾ãš<strong>HandlerMethodArgumentResolver</strong>ã‚’ä½¿ã£ã¦æ¤œè¨¼ã—ãŸç†ç”±ã¯SpringBootã‚’ä½¿ã£ã¦Applicationã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½œæˆã—ãªãŒã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®é€£é–¢é–¢ä¿‚ãŒã‚ã£ãŸã‹ã‚‰ã§ã™ã€‚</p>\\n<p>è‡ªåˆ†ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯Contestã¨è¨€ã†ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚\\nã“ã®Contestã¨è¨€ã†ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¸­ã§ã¯é–‹å‚¬è€…ã¨ã„ã†Contestã‚’ä½œã£ãŸäººã®æƒ…å ±ã‚’å…¥ã‚Œã‚Œã‚‹ColumnãŒã‚ã‚Šã¾ã™ã€‚\\nãªã®ã§ã“ã“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å…¥ã‚Œã‚‹ãŸã‚ã«Controllerã‹ã‚‰Member IDã‚’ã‚‚ã‚‰ã£ã¦é€£é–¢é–¢ä¿‚ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«<strong>HandlerMethodArgumentResolver</strong>ã‚’ä½¿ã„ã¾ã—ãŸã€‚</p>\\n<p>ã“ã“ã¾ã§ã¯åˆç†çš„ã ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€ã“ã®<strong>HandlerMethodArgumentResolver</strong>ã®Methodä¸­ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åˆ†è§£ã—ã¦ãã®ä¸­èº«ã‹ã‚‰IDã‚’Parsingã—ã¦ãã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã§çµ„ã‚“ã§ã„ãŸã“ã¨ãŒæ°—ã«ãªã‚Šã¾ã—ãŸã€‚</p>\\n<h2 id=\\"_2-è‡ªåˆ†ã®è€ƒãˆ\\" tabindex=\\"-1\\">2. è‡ªåˆ†ã®è€ƒãˆ <a class=\\"header-anchor\\" href=\\"#_2-è‡ªåˆ†ã®è€ƒãˆ\\" aria-label=\\"Permalink to &quot;2. è‡ªåˆ†ã®è€ƒãˆ&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>ä¾‹ã¯Java SpringBootã§èª¬æ˜ã—ã¾ã™ã€‚\\nJava SpringBootã‚’ä½¿ã£ã¦ã¿ãŸäººã¯Jwt Tokenã‚’ <strong>HandlerMethodArgumentResolver</strong> ã§åˆ†è§£ã—ã¦ä¸­ã®æƒ…å ±ã‚’å¾—ã‚‹æ„Ÿã˜ã§ä½¿ã£ã¦ããŸã‚“ã ã¨æ€ã„ã¾ã™ã€‚</p>\\n<div class=\\"language-java vp-adaptive-theme\\"><button title=\\"Copy Code\\" class=\\"copy\\"></button><span class=\\"lang\\">java</span><pre class=\\"shiki shiki-themes github-light github-dark vp-code\\" tabindex=\\"0\\" v-pre=\\"\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">@</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Component</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">public</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> class</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> ArgumentResolver</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> implements</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> HandlerMethodArgumentResolver</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Override</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    public</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> boolean</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> supportsParameter</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(MethodParameter </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">parameter</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        return</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> parameter.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">hasParameterAnnotation</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">([Annotation_Name].class);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Override</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    public</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> Object </span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">resolveArgument</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(MethodParameter </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">parameter</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, ModelAndViewContainer </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">mavContainer</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, NativeWebRequest </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">webRequest</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, WebDataBinderFactory </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">binderFactory</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">throws</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> Exception {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        HttpServletRequest httpServletRequest </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> webRequest.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getNativeRequest</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(HttpServletRequest.class);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        if</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (httpServletRequest </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">==</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\"> null</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">            return</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\"> null</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">        /*</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">        * èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#6A737D\\">        */</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">}</span></span></code></pre>\\n</div><p>ã‚‚ã¡ã‚ã‚“ã“ã®æ–¹æ³•ã‚‚ã„ã„æ–¹æ³•ã ã¨æ€ã£ã¦ãŠã‚Šã¾ã™ãŒã€ã‚‚ã—è‡ªåˆ†ãŒä¸­ã®æƒ…å ±ãŒè¦ã‚‰ãªãšãŸã è‡ªåˆ†ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ä¼šå“¡ç™»éŒ²ã—ãŸäººã ã‘ãŒAPIã‚’ä½¿ã£ã¦æ¬²ã—ã„Methodã‚‚ã‚ã‚‹æ™‚ã«å¿…è¦ãªã„æƒ…å ±ã‚’å¼·åˆ¶çš„ã«Parameterã§å—ã‘ã¦ã„ã‚‹ã¨æ€ã„ã¾ã—ãŸã€‚\\nãã—ã¦ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å¤šãã®è²¬ä»»ãŒå…¥ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã—ãŸã€‚\\nãªã®ã§ã“ã‚Œã‚’è§£æ±ºã™ã‚‹æ–¹æ³•ã‚’æ¨¡ç´¢ã—ãŸçµæœã€Filterã¨AOPã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>\\n<h3 id=\\"filterè¿½åŠ \\" tabindex=\\"-1\\">Filterè¿½åŠ  <a class=\\"header-anchor\\" href=\\"#filterè¿½åŠ \\" aria-label=\\"Permalink to &quot;Filterè¿½åŠ &quot;\\">&ZeroWidthSpace;</a></h3>\\n<p>ãªãœFilterã‚’è¿½åŠ ã—ãŸã‹ã¨ã„ã†ã¨ã€æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã¯å…ˆã»ã©è¨€ã£ãŸ<strong>HandlerMethodArgumentResolver</strong>ã®ä¸­ã§Jwt TokenãŒæœ‰åŠ¹ãªã®ã‹ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã§ã—ãŸã€‚</p>\\n<p>ã“ã‚ŒãŒResolverã®Methodã®ä¸­ã«å…¥ã£ã¦ã„ã‚‹ã“ã¨ã§ã“ã®Methodã¯Jwt Tokenåˆ†è§£ã€Jwt Tokenæœ‰åŠ¹æ¤œè¨¼ã®è²¬ä»»ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚\\nãªã®ã§ã“ã®è²¬ä»»ã®åˆ†æ•£ã®ãŸã‚ã«Filterã‚’ä½¿ã„ã€Headerã«å…¥ã£ã¦ãã‚‹TokenãŒæœ‰åŠ¹ãªã®ã‹ã‚’æ¤œè¨¼ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’Applicationã®Controllerãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å…¥ã£ã¦ãã‚‹å‰ã«å‡¦ç†ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>\\n<div class=\\"language-java vp-adaptive-theme\\"><button title=\\"Copy Code\\" class=\\"copy\\"></button><span class=\\"lang\\">java</span><pre class=\\"shiki shiki-themes github-light github-dark vp-code\\" tabindex=\\"0\\" v-pre=\\"\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">@</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Component</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">@</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">RequiredArgsConstructor</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">public</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> class</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> JwtTokenRequestFilter</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> extends</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> OncePerRequestFilter</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> static</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> final</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> String</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">[] WHITE_LIST </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> {</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">\\"/api/v1/users\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">\\"/api/v1/auth/login\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">\\"/css/*\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">};</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> final</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> JwtValidator jwtValidator;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Override</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    protected</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> void</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> doFilterInternal</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(HttpServletRequest </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">request</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, HttpServletResponse </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">response</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, FilterChain </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">filterChain</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">throws</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> ServletException, IOException {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        String token </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> JwtUtils.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">resolveToken</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(request.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getHeader</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(HttpHeaders.AUTHORIZATION)).</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">orElse</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\">null</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        if</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">filterValidate</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(request, token)) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">            filterChain.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">doFilter</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(request, response);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">            return</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        try</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">            Jws&#x3C;</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Claims</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">> claims </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> jwtValidator.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">validate</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(TokenType.ACCESS, token);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">            request.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">setAttribute</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(JwtUtils.CLAIMS_KEY, AuthInfo.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">from</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(claims));</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">            filterChain.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">doFilter</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(request, response);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        } </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">catch</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (JwtException </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">e</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">            response.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">sendError</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(HttpServletResponse.SC_UNAUTHORIZED, ErrorCode.INVALID_TOKEN.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getMessage</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">());</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> boolean</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> filterValidate</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(HttpServletRequest </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">request</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, String </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">token</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        return</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> isWhiteList</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(request.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getRequestURI</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">()) </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">||</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> token </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">==</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\"> null</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> boolean</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> isWhiteList</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(String </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">requestURL</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        return</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> PatternMatchUtils.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">simpleMatch</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(WHITE_LIST, requestURL);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">}</span></span></code></pre>\\n</div><p>ä¸Šã®Methodã¯<strong>OncePerRequestFilter</strong>ã¨ã„ã†interfaceã‚’implementã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯èªè¨¼ã¨ã„ã†å‹•ä½œã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€å€‹ãšã¤ä¸€å›ã ã‘å¿…è¦ãªä½œæ¥­ãªã®ã§Filterã‚’é‡ãªã‚ŠãªãŒã‚‰å‹•ä½œã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„å±é™ºæ€§ã‚’äºˆå ±ã—ã¾ã—ãŸã€‚</p>\\n<h3 id=\\"aopã®ä½¿ç”¨\\" tabindex=\\"-1\\">AOPã®ä½¿ç”¨ <a class=\\"header-anchor\\" href=\\"#aopã®ä½¿ç”¨\\" aria-label=\\"Permalink to &quot;AOPã®ä½¿ç”¨&quot;\\">&ZeroWidthSpace;</a></h3>\\n<p>ãã—ã¦å…ˆã»ã©è¨€ã£ã¦ãŸå½¹ç›®ã«ã‚ˆã‚‹Methodåˆ†é›¢ã®ãŸã‚ã«Annotationã‚’äºŒã¤ä½œã‚Šã¾ã—ãŸã€‚\\nä¸€ã¤ç›®ã¯**@AuthUser<strong>ã§ã€äºŒã¤ç›®ã¯</strong>@PreAuthorize**ã§ã™ã€‚</p>\\n<p>ã¾ãš**@AuthUser<strong>ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã®é€ä¿¡è€…ã®User IDã‚’ä½¿ã†Methodã«Parameterã§User IDã‚’ã‚‚ã‚‰ãˆã‚‹Annotationã§ã‚ã‚‹ã¾ã™ã€‚\\nã“ã®Annotationã¯</strong>HandlerMethodArgumentResolver**ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚</p>\\n<p>äºŒã¤ç›®ã¯**@PreAuthorize**ã§ã™ã€‚\\nã“ã®Annotationã¯Methodã«åˆ¶é™ã‚’æ›ã‘ã‚Œãªã„ã‹ãªï¼Ÿã¨ã„ã†ç–‘å•ã‹ã‚‰å§‹ã‚ã¾ã—ãŸã€‚\\nã‚µãƒ¼ãƒ“ã‚¹ã®ã‚µãƒ¼ãƒãƒ¼Applicationã‚’é–‹ç™ºã—ãªãŒã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹ç›®ã«ã‚ˆã‚‹Methodã®ä½¿ã„æ–¹åˆ†ã‘ã«Spring Securityã‚’å…¥ã‚ŒãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚\\nSpring Securityã‚’ä½¿ã£ãŸæ™‚ã«ä¾¿åˆ©ã§ã‚ã‚Šã€Contextã‚’ä½¿ã£ã¦ã„ã‚ã‚“ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰å…±é€šçš„ã«æƒ…å ±ã‚’ä½¿ãˆã‚‹ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã®ã‚’ä½“æ„Ÿã—ã¾ã—ãŸã€‚\\nã ã‘ã©ä¾¿åˆ©ãªæ©Ÿèƒ½ã«æ¯”ã¹ã¦è‡ªåˆ†ã®ã‚µãƒ¼ãƒ“ã‚¹ã«å…¥ã‚‰ãªã„æ©Ÿèƒ½ãŒå¤šã‹ã£ãŸã®ã‚‚ã‚ã‚Šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¤§ãããªã‚‹å•é¡ŒãŒã‚ã‚‹ã¨ã„ã†ã®ã‚’æ°—ã¥ãã¾ã—ãŸã€‚\\nãªã®ã§ã€Spring Securityã‚’ä½¿ã‚ãªãšå½¹ç›®ã«ã‚ˆã‚‹ä½¿ãˆã‚‹Methodã‚’åˆ†é›¢ã™ã‚‹ãŸã‚ã«ã“ã®Annotationã‚’ä½œã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚\\nç›®çš„ã‚’é”æˆã™ã‚‹ãŸã‚ã«AOPã¨ã„ã†æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚\\n<strong>@PreAuthorize</strong> Annotationã®ä¸­ã«nameã¨ã„ã†Parameterã‚’å…¥ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹ç›®ã«ã‚ˆã‚‹æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚</p>\\n<div class=\\"language-java vp-adaptive-theme\\"><button title=\\"Copy Code\\" class=\\"copy\\"></button><span class=\\"lang\\">java</span><pre class=\\"shiki shiki-themes github-light github-dark vp-code\\" tabindex=\\"0\\" v-pre=\\"\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">@</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Component</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">@</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Aspect</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">public</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> class</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> PreAuthorizeAspect</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">Around</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#9ECBFF\\">\\"@annotation(preAuthorize)\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    public</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> Object </span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">checkRoleForAuthorize</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(ProceedingJoinPoint </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">proceedingJoinPoint</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, PreAuthorize </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">preAuthorize</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">throws</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> Throwable {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        ServletRequestAttributes attrs </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> getRequestAttributes</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        HttpServletRequest request </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> attrs.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getRequest</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        AuthInfo authInfo </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> getAuthInfo</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(request);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">        userRoleVerification</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(authInfo, preAuthorize.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">role</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">());</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        return</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> proceedingJoinPoint.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">proceed</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> ServletRequestAttributes </span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getRequestAttributes</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">() {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        if</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (RequestContextHolder.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getRequestAttributes</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">() </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">instanceof</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> ServletRequestAttributes attributes) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">            return</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> attributes;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        throw</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> new</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> VerificationException</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(ErrorCode.NO_ATTRIBUTES);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> AuthInfo </span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getAuthInfo</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(HttpServletRequest </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">request</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        if</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (request.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">getAttribute</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(JwtUtils.CLAIMS_KEY) </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">instanceof</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> AuthInfo authInfo) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">            return</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> authInfo;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        throw</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> new</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> VerificationException</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(ErrorCode.NO_TOKEN);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> void</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> userRoleVerification</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(AuthInfo </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">authInfo</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">, String </span><span style=\\"--shiki-light:#E36209;--shiki-dark:#FFAB70\\">role</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        if</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (role </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">==</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#79B8FF\\"> null</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">            throw</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> new</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> VerificationException</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(ErrorCode.NO_AUTHORITY);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        UserRole standardRole </span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> UserRole.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">convert</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(role);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">        if</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\"> (</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">!</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">UserRole.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">verify</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(authInfo.</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\">role</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(), standardRole)) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\">            throw</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#F97583\\"> new</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#B392F0\\"> VerificationException</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">(ErrorCode.NO_AUTHORITY);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E1E4E8\\">}</span></span></code></pre>\\n</div><p>ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ã€ãƒãƒ¼ãƒ ãƒ¡ã‚¤ãƒˆã®äººã‹ã‚‰MethodãŒå½¹ç›®ã«ã‚ˆã‚‹åˆ†é›¢ãŒã—ã‚„ã™ããªã£ãŸã¨ã„ã†è©•ä¾¡ã‚’è²°ã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚\\nãã—ã¦å½¹ç›®ãŒè¿½åŠ ã•ã‚Œã¦ã‚‚UserRoleã«è¿½åŠ ã—ã¦ã€æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã“ã®Aspect Methodã«å…¥ã‚Œã‚‹ã“ã¨ã§ã€ç¶­æŒè£œä¿®ãŒã—ã‚„ã™ã„ã¨æ€ã£ã¦ãŠã‚Šã¾ã™ã€‚</p>\\n<h2 id=\\"æ„Ÿæƒ³\\" tabindex=\\"-1\\">æ„Ÿæƒ³ <a class=\\"header-anchor\\" href=\\"#æ„Ÿæƒ³\\" aria-label=\\"Permalink to &quot;æ„Ÿæƒ³&quot;\\">&ZeroWidthSpace;</a></h2>\\n<p>æœ€è¿‘è‡ªåˆ†ãŒä»Šæ‹…å½“ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§èªè¨¼ã‚’æ‹…å½“ã—ã¦ã„ã‚‹äººãŒJwt Tokenã‚’ç„¡æ„è­˜ã§ä½¿ã£ã¦ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã€‚\\nPRã‚’è²°ã£ãŸæ™‚ã€Jwt Tokenã‚’ä½¿ã£ã¦ç†ç”±ã«å¯¾ã—ã¦ã¡ã‚ƒã‚“ã¨èª¬æ˜ãŒã§ããªã„éƒ¨åˆ†ã‚’è¦‹ã¦ã€Jwt Tokenã®æ¦‚å¿µã‚„ã€åˆ©ç‚¹ã«ã¤ã„ã¦æ•™ãˆãªãŒã‚‰è‡ªåˆ†ã®è€ƒãˆãŒé–“é•ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ãƒãƒ¼ã‚¹ãƒˆã«æ›¸ã„ã¦æ„è¦‹ã‚’å…±æœ‰ã—ãŸã‹ã£ãŸã®ã§ã™ã€‚\\né–“é•ã£ã¦ã„ã‚‹ã¨ã“ã¨ã‹ã€è«–ç†çš„ã«å¤‰ãªã¨ã“ãŒã‚ã£ãŸã‚‰ãœã²æ•™ãˆã¦ä¸‹ã•ã„ã€‚</p>\\n","frontmatter":{"title":"Tokenæ¤œè¨¼ã«å¯¾ã™ã‚‹å·¥å¤«","description":"Tokenæ¤œè¨¼ã«å¯¾ã™ã‚‹å·¥å¤« Java SpringBoot","date":"2026-01-14T03:30:00.000Z","categories":["Tech"],"tags":["Java","SpringBoot","JWT","Security","Japanese"]},"excerpt":"","url":"/posts/token-verification-strategy/"}]'),c={class:"post-grid"},A=["href"],u={class:"post-content"},C={class:"post-title"},m={class:"post-meta"},B={class:"post-date"},D={key:0,class:"post-tags"},v={key:0,class:"post-description"},b={__name:"PostList",props:{posts:{type:Array,required:!0}},setup(e){function l(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}return(t,_)=>(a(),i("div",c,[(a(!0),i(p,null,r(e.posts,s=>(a(),i("a",{key:s.url,href:s.url,class:"post-card"},[n("div",u,[n("h3",C,h(s.frontmatter.title),1),n("div",m,[n("span",B,h(l(s.frontmatter.date)),1),s.frontmatter.tags?(a(),i("div",D,[(a(!0),i(p,null,r(s.frontmatter.tags,k=>(a(),i("span",{key:k,class:"tag"},h(k),1))),128))])):E("",!0)]),s.frontmatter.description?(a(),i("p",v,h(s.frontmatter.description),1)):E("",!0)])],8,A))),128))]))}},R=d(b,[["__scopeId","data-v-412dd94c"]]),f={class:"posts-container"},P=JSON.parse('{"title":"Posts","description":"","frontmatter":{"layout":"page","title":"Posts"},"headers":[],"relativePath":"posts/index.md","filePath":"posts/index.md"}'),S={name:"posts/index.md"},T=Object.assign(S,{setup(e){return(l,t)=>(a(),i("div",null,[n("div",f,[t[0]||(t[0]=n("h2",{id:"all-posts",tabindex:"-1"},[o("All Posts "),n("a",{class:"header-anchor",href:"#all-posts","aria-label":'Permalink to "All Posts"'},"â€‹")],-1)),g(R,{posts:y(F)},null,8,["posts"])])]))}});export{P as __pageData,T as default};
